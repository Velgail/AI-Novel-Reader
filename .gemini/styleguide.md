# プロジェクト Python スタイルガイド

## 概要
このドキュメントは、私たちのプロジェクトにおける Python のコーディング規約とコードレビューのガイドラインを定めます。Gemini Code Assist は、このガイドラインに従ってレビューを実施してください。一貫性のある読みやすいコードは、保守性とチームの生産性を向上させます。

## コードレビューの基本方針
レビューでは以下の点を重点的に確認してください。

* **正確性:** コードが仕様通りに動作し、エッジケースが適切に処理されているか。論理エラー、競合状態、API の誤用がないか。
* **効率性:** パフォーマンスのボトルネックや冗長な処理がないか。不必要なループ、メモリリーク、非効率なデータ構造、過剰な計算やロギングがないか。
* **保守性:** コードが読みやすく、モジュール化されており、変更・拡張が容易か。言語の慣用句やベストプラクティスに従っているか。不適切な命名、コメント不足、複雑すぎるロジック、コードの重複、一貫性のないフォーマット、マジックナンバーがないか。
* **セキュリティ:** 潜在的な脆弱性がないか。機密データの不安全な扱いや保存、インジェクション攻撃、不適切なアクセス制御、CSRF、IDOR などがないか。
* **テスト:** 十分な単体テストや結合テストが記述されており、コードの変更が既存の機能に影響を与えないことを保証しているか。
* **ドキュメンテーション:** コードの目的、使い方、複雑なロジックが適切に文書化されているか (Docstring を含む)。

## レビューコメントに関する指示
* **言語:** **レビューコメントは日本語で記述してください。**
* **具体性:** 問題点と推奨される修正案を具体的に、コード箇所を明示して示してください。
* **重要度:** コメントの重要度（例: `[MUST]`, `[SHOULD]`, `[NITS]`）を可能であれば明確にしてください。MUST は修正必須、SHOULD は強く推奨、NITS は些細な指摘を示します。
* **建設的:** 批判的ではなく、コードをより良くするための建設的なフィードバックを心がけてください。

## コーディング規約

### 1. コードレイアウト
* **インデント:** スペース4つを使用します。タブは使用しないでください。
* **行の長さ:** 1行あたり最大100文字とします。これを超える場合は、適切に改行してください。Python の暗黙的な行連結 (括弧、ブラケット、ブレース内) や、バックスラッシュ (`\`) を利用できますが、前者の方が推奨されます。
* **空行:** トップレベルの関数やクラス定義の間は2行、クラス内のメソッド定義の間は1行空けてください。関数内では、論理的なセクションを区切るために適度に空行を使用してください。
* **インポート:**
    * インポートはファイルの先頭にまとめて記述します。
    * 標準ライブラリ、サードパーティライブラリ、ローカルアプリケーション/ライブラリの順にグループ化し、各グループ間は1行空けます。
    * 各グループ内ではアルファベット順にソートします。
    * `from <module> import *` は避けてください。
    * 絶対インポートを推奨します。

### 2. 命名規則
* **変数:** 小文字のスネークケース (`snake_case`) を使用します (例: `user_name`, `total_count`)。
* **定数:** 大文字のスネークケース (`SNAKE_CASE`) を使用します (例: `MAX_OVERFLOW`, `GLOBAL_TIMEOUT`)。
* **関数:** 小文字のスネークケース (`snake_case`) を使用します (例: `calculate_total()`, `fetch_user_data()`)。
* **クラス:** キャメルケース (`CapWords`) を使用します (例: `UserServic`, `HttpRequest`)。
* **メソッド:** 小文字のスネークケース (`snake_case`) を使用します (例: `get_profile()`, `update_settings()`)。
* **モジュール:** 短く、全て小文字のスネークケース (`snake_case`) を使用します (例: `user_utils.py`, `db_connector.py`)。
* **パッケージ:** 短く、全て小文字の名前を使用します。アンダースコアは推奨されません (例: `services`, `utils`)。
* **プライベート:** アンダースコアで始まる名前 (`_private_variable`, `_internal_method`) は、内部実装の詳細であることを示します。`from module import *` ではインポートされません。
* **名前衝突回避:** クラス内で予約語と衝突する可能性がある場合は、末尾にアンダースコアを追加します (例: `class_`)。

### 3. コメントと Docstring
* **コメント:** コードが「何をしているか」ではなく「なぜそうなっているか」を説明するために使用します。複雑なアルゴリズムや、一見して意図が分かりにくい箇所に記述します。 `#` の後にスペースを一つ入れてください。
* **Docstring:** 全ての公開モジュール、関数、クラス、メソッドには Docstring を記述します。
    * `"""Docstring はここに記述します。"""` の形式を使用します。
    * 1行目はモジュールの目的を簡潔に要約します。
    * 必要に応じて、より詳細な説明、引数 (`Args:`), 戻り値 (`Returns:`), 発生する可能性のある例外 (`Raises:`) を記述します。
    * Google スタイルまたは reStructuredText スタイルを推奨します。

    ```python
    def calculate_area(width: float, height: float) -> float:
        """矩形の面積を計算します。

        Args:
            width (float): 矩形の幅。
            height (float): 矩形の高さ。

        Returns:
            float: 計算された面積。

        Raises:
            ValueError: 幅または高さが負の場合。
        """
        if width < 0 or height < 0:
            raise ValueError("幅と高さは非負である必要があります。")
        return width * height
    ```

### 4. 型ヒント
* 可能な限り型ヒントを使用します (PEP 484)。コードの可読性を高め、静的解析ツールによるエラー検出を助けます。
* 複雑な型には `typing` モジュールを活用します (例: `List[int]`, `Dict[str, Any]`, `Optional[str]`)。

### 5. エラーハンドリング
* 具体的な例外クラスを使用します。汎用的な `Exception` をキャッチするのは避けてください (ただし、ロギングやリソース解放が目的の場合は除く)。
* `try...except` ブロックは、例外が発生する可能性のある最小限のコード範囲に適用します。
* 例外をキャッチした場合は、ログに記録するか、適切に処理または再送出してください。単に `pass` で無視するのは避けてください。
* 独自のエラークラスを定義する場合は、Python の組み込み例外クラスを継承してください。

### 6. テスト
* 重要な機能やロジックには単体テストを作成します。`unittest` または `pytest` フレームワークの使用を推奨します。
* テストはコードの変更に対するリグレッションを防ぎ、リファクタリングを容易にします。
* テストケースは明確で、独立しており、再現可能であるべきです。

### 7. その他
* **マジックナンバー:** コード中に直接数値を記述するのではなく、意味のある名前の定数を使用してください。
* **Boolean の比較:** `if is_active == True:` ではなく `if is_active:`、`if result == False:` ではなく `if not result:` と記述してください。
* **文字列フォーマット:** f-string (フォーマット済み文字列リテラル) の使用を推奨します (Python 3.6+)。
* **コンテキストマネージャ:** ファイル操作やロックなど、リソースの確保と解放が必要な場合は `with` 文を使用してください。

---

このスタイルガイドは、プロジェクトの進化に合わせて更新される可能性があります。
